% è¥¿å—æž—ä¸šå¤§å­¦æœ¬ç§‘æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰å¼€é¢˜æŠ¥å‘Šï¼ˆç•™å­¦ç”Ÿç‰ˆï¼‰
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{swfuproposale}

% pass unknown options to article
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{article}}
\ProcessOptions\relax

\LoadClass{article}

\RequirePackage{fontspec}
\newfontfamily\dejavu{DejaVu Sans Mono}%
\newfontfamily\purisa{Purisa}
\newcommand\unchecked{{\dejavu â–¡}} %ballot box
\newcommand\checked{{\large\dejavu â˜‘}} %ðŸ—¹

\RequirePackage{pgfkeys}

\pgfkeys{%
  PrjFrmA/.store in       = \SWFU@PrjFrmA, PrjFrmA={\unchecked{}}, %ç§‘ç ”é¡¹ç›®
  PrjFrmB/.store in       = \SWFU@PrjFrmB, PrjFrmB={\unchecked{}}, %ç¤¾ä¼šå®žè·µ
  PrjFrmC/.store in       = \SWFU@PrjFrmC, PrjFrmC={\unchecked{}}, %å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®
  PrjFrmD/.store in       = \SWFU@PrjFrmD, PrjFrmD={\unchecked{}}, %å…¶å®ƒæ¥æº
  Studid/.store in         = \SWFU@Studid, % å­¦å·
  Advisor/.store in        = \SWFU@Advisor, Advisor=,             % æŒ‡å¯¼æ•™å¸ˆ
  AdvisorSig/.store in     = \SWFU@AdvisorSig, AdvisorSig=,       % æŒ‡å¯¼æ•™å¸ˆç­¾å
  AdvisorTitle/.store in   = \SWFU@AdvisorTitle, AdvisorTitle=,   %æŒ‡å¯¼æ•™å¸ˆèŒç§°
  AdvisorGender/.store in  = \SWFU@AdvisorGender, AdvisorGender=, %æŒ‡å¯¼æ•™å¸ˆæ€§åˆ«
  AdvisorAge/.store in     = \SWFU@AdvisorAge, AdvisorAge=,       %æŒ‡å¯¼æ•™å¸ˆå¹´é¾„
  AdvisorDegree/.store in  = \SWFU@AdvisorDegree, AdvisorDegree=, %æŒ‡å¯¼æ•™å¸ˆå­¦ä½
  AdvisorFrom/.store in   = \SWFU@AdvisorFrom, AdvisorFrom={College of Big Data and
    Intelligent Engineering},%
  AdvisorComment/.store in = \SWFU@AdvisorComment, % æŒ‡å¯¼æ•™å¸ˆæ„è§
  Date/.store in           = \SWFU@Date,      % å¡«è¡¨æ—¶é—´(å¹´/æœˆ/æ—¥ï¼‰
  Subject/.store in        = \SWFU@Subject, Subject={Computer science and technology}, % ä¸“ä¸š
  Grade/.store in          = \SWFU@Grade,     % å¹´çº§
  Partone/.store in        = \SWFU@Partone,   % 1. è¯¥ç ”ç©¶çš„ç›®çš„ã€æ„ä¹‰
  Parttwo/.store in        = \SWFU@Parttwo,   % 2. å›½å†…å¤–ç ”ç©¶çŽ°çŠ¶åŠå‘å±•è¶‹åŠ¿
  Partthree/.store in      = \SWFU@Partthree, % 3. ä¸»è¦å‚è€ƒæ–‡çŒ®
  Partfour/.store in       = \SWFU@Partfour,  % 4. è¯¥ç ”ç©¶çš„ä¸»è¦å†…å®¹ï¼Œé‡ç‚¹è§£å†³çš„é—®é¢˜ï¼Œé¢„æœŸç»“æžœæˆ–æˆæžœ
  Partfive/.store in       = \SWFU@Partfive,  % 5. æ‹Ÿé‡‡å–çš„ç ”ç©¶æ–¹æ³•æˆ–å®žéªŒæ–¹æ³•ï¼Œ
                                              %    æ­¥éª¤ï¼Œå¯èƒ½å‡ºçŽ°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³åŠžæ³•
  Partsix/.store in        = \SWFU@Partsix,   % 6. å®Œæˆè¯¥ç ”ç©¶å·²å…·å¤‡çš„æ¡ä»¶  
}

\newcommand{\swfusetup}[1]{\pgfkeys{#1}}

\RequirePackage[%showframe,%showcrop,
top=3cm,bottom=2.5cm,left=3cm,right=2.5cm,
nomarginpar,headheight=15pt, % to avoid "headheight too small"
]{geometry}

\RequirePackage{graphicx} % before xltxtra
\graphicspath{{./figs/}{./}{../}} %mind the trailing â€œ/â€

\RequirePackage{caption,subcaption}% \captionof{table|figure}{t|f}

\RequirePackage{tabularray,tabularx,longtable,booktabs,makecell,multicol,multirow,array}
\renewcommand{\arraystretch}{1.5}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % centering m column
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}} % centering p column
\newcolumntype{R}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{L}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\RequirePackage{indentfirst,enumitem} % \setlist
\setlist{nosep} % kills all vertical spacing

%%%%% hyperref
\RequirePackage{xcolor}
\RequirePackage{hyperref}
\hypersetup{%
  bookmarksnumbered, breaklinks=true,%
  colorlinks=false,%
  pdfborderstyle={/S/U/W .3},% underline of width .3pt 
  linkbordercolor=red,       % internal links
  citebordercolor=cyan,      % links to bibliography
  filebordercolor=magenta,   % file links
  urlbordercolor=blue,       % external links
}
\def\UrlBreaks{\do\/\do-} % break long url

%%%%% biblatex
\RequirePackage[backend=biber,%
style=gb7714-2015,gbpub=false,gbtype=false,gbpunctin=false,%
url=false,doi=false,isbn=false]{biblatex}

% https://tex.stackexchange.com/questions/247185/tcolorbox-theorem-which-isnt-framed-on-the-sides
\RequirePackage[breakable]{tcolorbox}
\newtcolorbox{mainbodybox}[1]{breakable,sharp corners,nobeforeafter,%
  colback=white,coltitle=black,colbacktitle=white,%
  boxrule=.5pt,titlerule=0pt,%
  bottomrule at break=.5pt,after skip=-1.5pt,% bottomrule=0pt, bottom=1em,
  before upper={\parindent 2em},% indentfirst  
  fonttitle=\large\bfseries,title=#1}

% \singlespacing, \onehalfspacing, \doublespacing
\RequirePackage[doublespacing]{setspace}
\renewcommand\doublespacing{\setstretch{1.6}}

\setlength{\parindent}{2em}

\pagestyle{empty}

\newcommand{\SWFUtitlepage}{% Title page layout
  \thispagestyle{empty}
  \begin{center}
    {%
      \LARGE\bfseries%
      \mbox{Southwest Forestry University}\\
      \mbox{Undergraduate Thesis (Design) Proposal}\\
    }%
    \vskip 3cm
    \begin{Large}\singlespacing
      \begin{tblr}{width=\linewidth,colspec={rX[c]},rows={m},hline{2}={2}{}}
        Thesis title:&\@title\\
      \end{tblr}
      \vskip 2cm
      \begin{tblr}{width=.8\linewidth,colspec={rX[c]},%
          rows={m,belowsep=0pt,abovesep=15pt},%rowsep=15pt,%rows={m},
          hline{2-7}={2}{.4pt,solid}}
        Name:&\@author\\
        ID:&\SWFU@Studid\\
        Subject:&\SWFU@Subject\\
        Instructor (title):&\SWFU@Advisor{} (\SWFU@AdvisorTitle{})\\
        &\\
        Date:&\SWFU@Date\\
      \end{tblr}
    \end{Large}
    \vfill
    {\Large\bfseries  Academic Affairs Office, SWFU}\\[1cm]
  \end{center}
  \clearpage}

\newcommand{\instructionpage}{% Instruction page
  \begin{center}
    \LARGE\bfseries Instruction
  \end{center}
  \vskip 5ex
  \begin{itemize}
  \item The content of the opening report must be truthful from facts, fill
     it's carefully one by one, and express clearly and extremely
     through careful way. Mainly key words should be expressed in
     both Chinese and English, and the full name of the abbreviation
     that appears for the first time must be noted.

  \item The opening report needs to be printed by you, all in A4 format,
     bound into a book on the left. If there are not enough spaces in
     each column, please add pages by yourself.

  \item The opening report must be completed before the start of the
     eighth semester.

  \item The opening report should be put into the graduation thesis
     (design) portfolio of Southwest Forestry University.
  \end{itemize}
  \clearpage}

\newcommand\mkhead{
  \begin{singlespace}
    \noindent
    \begin{tblr}{width=\linewidth, colspec={cccccX[c]}, hlines, vlines,%
        rows={m}, cell{1}{1}={r=3}{m}, cell{4}{2}={c=6}{m,l},%
      }
      {Instructors\\info}&Name&Gender&Age&Degree&Position (Title)&Employer\\
      &\SWFU@Advisor&\SWFU@AdvisorGender&\SWFU@AdvisorAge&%
      \SWFU@AdvisorDegree&\SWFU@AdvisorTitle&\SWFU@AdvisorFrom\\
      &&&&&&\\
      {Project\\source}&%
      {\qquad\SWFU@PrjFrmA{}\;Funded research project\\
      \qquad\SWFU@PrjFrmB{}\;Social practice\\
      \qquad\SWFU@PrjFrmC{}\;Undergraduate Innovation and Entrepreneurship Project\\
      \qquad\SWFU@PrjFrmD{}\;Other source}\\
    \end{tblr}
  \end{singlespace}
}

\newcommand\mktail{%
  \section{The instructor's opinion}

  \SWFU@AdvisorComment\par
  \begin{flushright}
    \begin{tblr}{width=.3\linewidth,colspec={rX}}%
      Signature:&\SWFU@AdvisorSig\\
      Date:&{\purisa\SWFU@Date}\\
    \end{tblr}
  \end{flushright}\par
  \bigskip  
  \noindent%
  \begin{tblr}{width=\linewidth,colspec={XX},hline{1,7}={solid},vlines,%
      row{1}={h,l,font=\small}, row{5-6}={f,r},
    }
    {Department approval:}&{School approval:}\\
    &\\
    &\\
    &\\
    \makebox[15em][l]{Signature:}&\makebox[15em][l]{Signature:}\\
    \makebox[13em][l]{Date:}&\makebox[13em][l]{Date:}\\
  \end{tblr}
}

\newcommand{\front}{%
  \SWFUtitlepage{}
  \instructionpage{}
  \mkhead{}
}
