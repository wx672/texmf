% è¥¿å—æ—ä¸šå¤§å­¦æœ¬ç§‘æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰å¼€é¢˜æŠ¥å‘Š
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{swfuproposal}

% pass unknown options to book
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{aritcle}}
\ProcessOptions\relax

\LoadClass[scheme=plain]{ctexart}

%\RequirePackage{ifxetex} % XeTeX only
\RequirePackage{zhlipsum}

\newfontfamily\nerd{DejaVu Sans Mono Nerd Font Complete}%
\newcommand\unchecked{{\nerd â–¡}} %ballot box
\newcommand\checked{{\large\nerd ğŸ—¹}} %â˜‘

\RequirePackage{pgfkeys}

\pgfkeys{%
  Title/.store in          = \@title,          %è®ºæ–‡æ ‡é¢˜
  Author/.store in         = \@author,         %ä½œè€…
  Projfrom/.store in       = \SWFU@Projfrom, Projfrom=è‡ªé€‰, %
  Chk/.store in          = \SWFU@Chk, Chk={\unchecked}, %è¯¾é¢˜æ¥æºæ‰“å‹¾
  Studid/.store in         = \SWFU@Studid,         %å­¦å·
  Advisor/.store in        = \SWFU@Advisor, Advisor=ç‹æ™“æ—, %æŒ‡å¯¼æ•™å¸ˆ
  AdvisorSig/.store in     = \SWFU@AdvisorSig,     %æŒ‡å¯¼æ•™å¸ˆç­¾å
  AdvisorTitle/.store in   = \SWFU@AdvisorTitle, AdvisorTitle=è®²å¸ˆ, %æŒ‡å¯¼æ•™å¸ˆèŒç§°
  AdvisorGender/.store in  = \SWFU@AdvisorGender, AdvisorGender=ç”·, %æŒ‡å¯¼æ•™å¸ˆæ€§åˆ«
  AdvisorAge/.store in     = \SWFU@AdvisorAge, AdvisorAge=50,%æŒ‡å¯¼æ•™å¸ˆå¹´é¾„
  AdvisorDegree/.store in  = \SWFU@AdvisorDegree, AdvisorDegree=ç¡•å£«, %æŒ‡å¯¼æ•™å¸ˆå­¦ä½
  AdvisorWhere/.store in   = \SWFU@AdvisorWhere, AdvisorWhere=å¤§æ•°æ®ä¸ä¿¡æ¯å·¥ç¨‹å­¦é™¢, %æŒ‡å¯¼æ•™
                                %å¸ˆæ‰€å±é™¢ç³»
  AdvisorComment/.store in = \SWFU@AdvisorComment, %æŒ‡å¯¼æ•™å¸ˆæ„è§
  Date/.store in           = \SWFU@Date,           %æ—¥
  Month/.store in          = \SWFU@Month,          %æœˆ
  Year/.store in           = \SWFU@Year,           %å¹´
  Subject/.store in        = \SWFU@Subject,        %ä¸“ä¸š
  Grade/.store in          = \SWFU@Grade,          %å¹´çº§
  Partone/.store in        = \SWFU@Partone,        %1. è¯¥ç ”ç©¶çš„ç›®çš„ã€æ„ä¹‰
  Parttwo/.store in        = \SWFU@Parttwo,        %2. å›½å†…å¤–ç ”ç©¶ç°çŠ¶åŠå‘å±•è¶‹åŠ¿
  Partthree/.store in      = \SWFU@Partthree,      %3. ä¸»è¦å‚è€ƒæ–‡çŒ®
  Partfour/.store in       = \SWFU@Partfour,       %4. è¯¥ç ”ç©¶çš„ä¸»è¦å†…å®¹ï¼Œé‡ç‚¹è§£å†³çš„é—®é¢˜ï¼Œé¢„æœŸç»“æœæˆ–æˆæœ
  Partfive/.store in       = \SWFU@Partfive,       %5. æ‹Ÿé‡‡å–çš„ç ”ç©¶æ–¹æ³•æˆ–å®éªŒæ–¹æ³•ï¼Œæ­¥éª¤ï¼Œå¯èƒ½å‡ºç°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³åŠæ³•
  Partsix/.store in        = \SWFU@Partsix,        %6. å®Œæˆè¯¥ç ”ç©¶å·²å…·å¤‡çš„æ¡ä»¶  
}

\newcommand{\swfusetup}[1]{\pgfkeys{#1}}

\RequirePackage[top=3cm,bottom=2.5cm,left=3cm,right=2.5cm,
nomarginpar,headheight=15pt, % to avoid "headheight too small"
%showframe,showcrop,
]{geometry}

\RequirePackage{graphicx} % before xltxtra
\graphicspath{{./figs/}{./}{../}} %mind the trailing â€œ/â€

\RequirePackage{tabularx,longtable,booktabs,makecell,multicol,multirow,array}
\renewcommand{\arraystretch}{1.5}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % centering m column
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}} % centering p column
\newcolumntype{R}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{L}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\RequirePackage{indentfirst,enumitem} % \setlist
\setlist{nosep} % kills all vertical spacing

\RequirePackage{wx672hyperref}
\RequirePackage{wx672bib}

\RequirePackage{xcolor}
\RequirePackage{wx672hyperref}

% https://tex.stackexchange.com/questions/247185/tcolorbox-theorem-which-isnt-framed-on-the-sides
\RequirePackage[breakable]{tcolorbox}
\newtcolorbox{mainbodybox}[1]{breakable,sharp corners,
  colback=white,coltitle=black,colbacktitle=white,
  boxrule=.5pt,titlerule=0pt,
  bottom=2ex,
  fonttitle=\bfseries,title=#1}

\newtcolorbox{mainlistbox}[1]{sharp corners,
  colback=white,coltitle=black,colbacktitle=white,
  boxrule=.5pt,titlerule=0pt,
  toptitle=1ex,bottomtitle=3ex,center title,
  fonttitle=\bfseries,title={\Huge #1}}

% \singlespacing, \onehalfspacing, \doublespacing
\RequirePackage[doublespacing]{setspace}
\renewcommand{\doublespacing}{\setstretch{1.6}}

\setlength{\parindent}{2em}

\pagestyle{empty}

\newcommand{\SWFUtitlepage}{% Title page layout
  \thispagestyle{empty}
  \begin{center}
    \makebox[14.7em][s]{\Large\heiti è¥¿å—æ—ä¸šå¤§å­¦}\\[5mm]
    \makebox[20em][s]{\Large\heiti æœ¬ç§‘æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰å¼€é¢˜æŠ¥å‘Š}\\[5mm]
    \vskip 3cm
    \begin{large}
    \begin{minipage}{1.0\linewidth}
      \begin{tabularx}{\textwidth}{@{}rX@{}}
        è®º\,æ–‡\,é¢˜\,ç›®&%
        \makebox[0pt][t]{%
          \begin{minipage}[t]{30em}
            \begin{center}
              \parbox[t]{29em}{\centering\bfseries\Large\@title}
            \end{center}
          \end{minipage}}%
        \rule[-1.5ex]{30em}{.1pt}\par%
        \rule[-1.5ex]{30em}{.1pt}\\%
      \end{tabularx}
    \end{minipage}
    \vskip 2cm
    \begin{minipage}{.8\linewidth}
      \begin{center}
        \begin{tabularx}{\textwidth}{@{}rC@{}}
          ä¸“\hspace{1em}ä¸š\hspace{1em}å\hspace{1em}ç§°&\SWFU@Subject\\\cline{2-2}
          å¹´\hspace{5em}çº§&\SWFU@Grade\\\cline{2-2}
          å­¦\hspace{1em}ç”Ÿ\hspace{1em}å§“\hspace{1em}å&\@author\\\cline{2-2}
          å­¦\hspace{1em}ç”Ÿ\hspace{1em}å­¦\hspace{1em}å·&\SWFU@Studid\\\cline{2-2}
          æŒ‡å¯¼æ•™å¸ˆï¼ˆèŒç§°ï¼‰&\SWFU@Advisor{}ï¼ˆ\SWFU@AdvisorTitleï¼‰ \\\cline{2-2}
          &\\\cline{2-2}
          å¡«\hspace{1em}è¡¨\hspace{1em}æ—¶\hspace{1em}é—´&
          \SWFU@Year{}å¹´\,\SWFU@Month{}æœˆ\,\SWFU@Date{}æ—¥\\\cline{2-2}
        \end{tabularx}
      \end{center}
    \end{minipage}
  \end{large}
  \vfill
  {\Large\bfseries è¥¿å—æ—ä¸šå¤§å­¦æ•™åŠ¡å¤„åˆ¶}\\[1cm]
\end{center}
\clearpage}

\newcommand{\instructionpage}{% Instruction page
  \begin{center}
    {\LARGE\bfseries å¡«\quad è¡¨\quad è¯´\quad æ˜}\\[5mm]
  \end{center}
  \vskip 3ex
  \begin{itemize}
  \item[ä¸€ã€] å¼€é¢˜æŠ¥å‘Šå„é¡¹å†…å®¹è¦å®äº‹æ±‚æ˜¯ï¼Œé€æ¡è®¤çœŸå¡«å†™ï¼Œè¡¨è¾¾è¦æ˜ç¡®ã€ä¸¥è°¨ã€‚å¤–æ¥è¯­åº”ç”¨ä¸­æ–‡å’Œ
    è‹±æ–‡åŒæ—¶è¡¨è¾¾ï¼Œç¬¬ä¸€æ¬¡å‡ºç°çš„ç¼©å†™è¯ï¼Œé¡»æ³¨å‡ºå…¨ç§°ã€‚
  \item[äºŒã€] å¼€é¢˜æŠ¥å‘Šéœ€ç”¨è®¡ç®—æœºæ‰“å°ï¼Œä¸€å¾‹ä¸º A4 å¼€æœ¬ï¼Œäºå·¦ä¾§è£…è®¢æˆå†Œã€‚å„æ ç©ºæ ¼ä¸å¤Ÿæ—¶ï¼Œè¯·è‡ª
    è¡ŒåŠ é¡µã€‚
  \item[ä¸‰ã€] å¼€é¢˜æŠ¥å‘Šéœ€åœ¨ç¬¬å…«å­¦æœŸå¼€å­¦ä¹‹å‰å®Œæˆã€‚
  \item[å››ã€] å¼€é¢˜æŠ¥å‘Šéœ€è£…å…¥è¥¿å—æ—ä¸šå¤§å­¦æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰æ¡£æ¡ˆè¢‹ã€‚
  \end{itemize}
  \clearpage}

\newcommand{\tablebody}{% main part
  \singlespacing\noindent
  \begin{tabularx}{\linewidth}{|M{2em}|@{}X@{}|}\hline
    æŒ‡å¯¼æ•™å¸ˆ\par{}åŸºæœ¬æƒ…å†µ%
    & {\begin{tabularx}{\linewidth}{c|c|c|c|c|C}
        æŒ‡å¯¼æ•™å¸ˆå§“å&\makecell*{æ€§\\åˆ«}&\makecell*{å¹´\\é¾„}&\makecell*{å­¦å†æˆ–\\å­¦ä½}&\makecell*{ä¸“ä¸šæŠ€æœ¯\\èŒåŠ¡æˆ–èŒç§°}&å·¥ä½œå•ä½\\\hline
        \SWFU@Advisor&\SWFU@AdvisorGender&\SWFU@AdvisorAge&
        \SWFU@AdvisorDegree&\SWFU@AdvisorTitle&\SWFU@AdvisorWhere\\\hline
        &&&&&\\
      \end{tabularx}}\\\hline
    è¯¾é¢˜æ¥æº&\quad \SWFU@Chk{}ç§‘ç ”é¡¹ç›®\quad\SWFU@Chk{}ç¤¾ä¼šå®è·µ\quad\SWFU@Chk{} å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®\quad\SWFU@Chk{}å…¶å®ƒæ¥æº\\
  \end{tabularx}
  \vskip -1ex
  \begin{mainbodybox}{1.\, è¯¥ç ”ç©¶çš„ç›®çš„ã€æ„ä¹‰}
    \SWFU@Partone
  \end{mainbodybox}
  \vskip -1.7ex
  \begin{mainbodybox}{2.\, å›½å†…å¤–ç ”ç©¶ç°çŠ¶åŠå‘å±•è¶‹åŠ¿}
    \SWFU@Parttwo
  \end{mainbodybox}
  \vskip -1.7ex
  \begin{mainbodybox}{3.\, ä¸»è¦å‚è€ƒæ–‡çŒ®}
    \SWFU@Partthree
  \end{mainbodybox}
  \vskip -1.7ex
  \begin{mainbodybox}{4.\, è¯¥ç ”ç©¶çš„ä¸»è¦å†…å®¹ï¼Œé‡ç‚¹è§£å†³çš„é—®é¢˜ï¼Œé¢„æœŸç»“æœæˆ–æˆæœ}
    \SWFU@Partfour
  \end{mainbodybox}
  \vskip -1.7ex
  \begin{mainbodybox}{5.\, æ‹Ÿé‡‡å–çš„ç ”ç©¶æ–¹æ³•æˆ–å®éªŒæ–¹æ³•ï¼Œæ­¥éª¤ï¼Œå¯èƒ½å‡ºç°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³åŠæ³•}
    \SWFU@Partfive
  \end{mainbodybox}
  \vskip -1.7ex
  \begin{mainbodybox}{6.\, å®Œæˆè¯¥ç ”ç©¶å·²å…·å¤‡çš„æ¡ä»¶}
    \SWFU@Partsix
  \end{mainbodybox}
  \vspace*{-1ex}
  \noindent
  \begin{tabularx}{\linewidth}{|r@{\ }X|}\hline
  &æŒ‡å¯¼æ•™å¸ˆæ„è§\\[2ex]
    &\hspace{3em}{\Large\SWFU@AdvisorComment}\\[-1ex]
    &\hfill ç­¾åï¼š\makebox[7em]{\SWFU@AdvisorSig}\\
    &\hfill\SWFU@Year å¹´ \SWFU@Month æœˆ \SWFU@Date æ—¥\\\hline
  \end{tabularx}\vspace*{-1pt}
  \noindent
  \begin{tabularx}{\linewidth}{|m{1em}|X|m{1em}|X|}
    æ•™ç ”å®¤æ„è§&%
    \begin{tabular}{l}%
      æ•™ç ”å®¤è´Ÿè´£äººï¼š\\%[6ex]
      \vspace*{10ex}\\
      \hspace{5em}æ—¶é—´ï¼š\hspace{4em}å¹´\hspace{2em}æœˆ\hspace{2em}æ—¥\\%[-3ex]
    \end{tabular} &%
    æ•™å­¦é™¢ç³»éƒ¨æ„è§&%
    \begin{tabular}{l}%
      æ•™å­¦é™¢ç³»éƒ¨è´Ÿè´£äººï¼š\\%[4ex]
      \vspace*{10ex}\\
      \hspace{5em}æ—¶é—´ï¼š\hspace{4em}å¹´\hspace{2em}æœˆ\hspace{2em}æ—¥\\%[-3ex]
    \end{tabular}\\\hline
  \end{tabularx}}

\newcommand{\makeproposal}{% preliminary pages
  \SWFUtitlepage{}
  \doublespacing% global line spacing
  \instructionpage{}
  \tablebody{}}
