% è¥¿å—æ—ä¸šå¤§å­¦æœ¬ç§‘æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰å¼€é¢˜æŠ¥å‘Š
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{swfuproposal}

% pass unknown options to ctexart
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{ctexart}}
\ProcessOptions\relax

\LoadClass[scheme=chinese]{ctexart}

\newfontfamily\dejavu{DejaVu Sans Mono}%
\newcommand\unchecked{{\dejavu â–¡}} %ballot box
\newcommand\checked{{\large\dejavu â˜‘}} %ğŸ—¹

\RequirePackage{pgfkeys}

\pgfkeys{%
  PrjFrmA/.store in       = \SWFU@PrjFrmA, PrjFrmA={\unchecked{}}, %ç§‘ç ”é¡¹ç›®
  PrjFrmB/.store in       = \SWFU@PrjFrmB, PrjFrmB={\unchecked{}}, %ç¤¾ä¼šå®è·µ
  PrjFrmC/.store in       = \SWFU@PrjFrmC, PrjFrmC={\unchecked{}}, %å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®
  PrjFrmD/.store in       = \SWFU@PrjFrmD, PrjFrmD={\unchecked{}}, %å…¶å®ƒæ¥æº
  Studid/.store in         = \SWFU@Studid, % å­¦å·
  Advisor/.store in        = \SWFU@Advisor, Advisor=,             % æŒ‡å¯¼æ•™å¸ˆ
  AdvisorSig/.store in     = \SWFU@AdvisorSig, AdvisorSig=,       % æŒ‡å¯¼æ•™å¸ˆç­¾å
  AdvisorTitle/.store in   = \SWFU@AdvisorTitle, AdvisorTitle=,   %æŒ‡å¯¼æ•™å¸ˆèŒç§°
  AdvisorGender/.store in  = \SWFU@AdvisorGender, AdvisorGender=, %æŒ‡å¯¼æ•™å¸ˆæ€§åˆ«
  AdvisorAge/.store in     = \SWFU@AdvisorAge, AdvisorAge=,       %æŒ‡å¯¼æ•™å¸ˆå¹´é¾„
  AdvisorDegree/.store in  = \SWFU@AdvisorDegree, AdvisorDegree=, %æŒ‡å¯¼æ•™å¸ˆå­¦ä½
  AdvisorFrom/.store in   = \SWFU@AdvisorFrom, AdvisorFrom=å¤§æ•°æ®ä¸æ™ºèƒ½å·¥ç¨‹å­¦é™¢,%
  AdvisorComment/.store in = \SWFU@AdvisorComment, % æŒ‡å¯¼æ•™å¸ˆæ„è§
  Date/.store in           = \SWFU@Date,      % å¡«è¡¨æ—¶é—´(æ—¥)
  Month/.store in          = \SWFU@Month,     % å¡«è¡¨æ—¶é—´(æœˆ)
  Year/.store in           = \SWFU@Year,      % å¡«è¡¨æ—¶é—´(å¹´)
  Subject/.store in        = \SWFU@Subject,   % ä¸“ä¸š
  Grade/.store in          = \SWFU@Grade,     % å¹´çº§
  Partone/.store in        = \SWFU@Partone,   % 1. è¯¥ç ”ç©¶çš„ç›®çš„ã€æ„ä¹‰
  Parttwo/.store in        = \SWFU@Parttwo,   % 2. å›½å†…å¤–ç ”ç©¶ç°çŠ¶åŠå‘å±•è¶‹åŠ¿
  Partthree/.store in      = \SWFU@Partthree, % 3. ä¸»è¦å‚è€ƒæ–‡çŒ®
  Partfour/.store in       = \SWFU@Partfour,  % 4. è¯¥ç ”ç©¶çš„ä¸»è¦å†…å®¹ï¼Œé‡ç‚¹è§£å†³çš„é—®é¢˜ï¼Œé¢„æœŸç»“æœæˆ–æˆæœ
  Partfive/.store in       = \SWFU@Partfive,  % 5. æ‹Ÿé‡‡å–çš„ç ”ç©¶æ–¹æ³•æˆ–å®éªŒæ–¹æ³•ï¼Œ
                                              %    æ­¥éª¤ï¼Œå¯èƒ½å‡ºç°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³åŠæ³•
  Partsix/.store in        = \SWFU@Partsix,   % 6. å®Œæˆè¯¥ç ”ç©¶å·²å…·å¤‡çš„æ¡ä»¶  
}

\newcommand{\swfusetup}[1]{\pgfkeys{#1}}

\RequirePackage[%showframe,%showcrop,
top=3cm,bottom=2.5cm,left=3cm,right=2.5cm,
nomarginpar,headheight=15pt, % to avoid "headheight too small"
]{geometry}

\RequirePackage{graphicx} % before xltxtra
\graphicspath{{./figs/}{./}{../}} %mind the trailing â€œ/â€

\RequirePackage{caption,subcaption}% \captionof{table|figure}{t|f}

\RequirePackage{tabularx,longtable,booktabs,makecell,multicol,multirow,array}
\renewcommand{\arraystretch}{1.5}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % centering m column
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}} % centering p column
\newcolumntype{R}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{L}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\RequirePackage{indentfirst,enumitem} % \setlist
\setlist{nosep} % kills all vertical spacing

%%%%% hyperref
\RequirePackage{xcolor}
\RequirePackage{hyperref}
\hypersetup{%
  bookmarksnumbered, breaklinks=true,%
  colorlinks=false,%
  pdfborderstyle={/S/U/W .3},% underline of width .3pt 
  linkbordercolor=red,       % internal links
  citebordercolor=cyan,      % links to bibliography
  filebordercolor=magenta,   % file links
  urlbordercolor=blue,       % external links
}
\def\UrlBreaks{\do\/\do-} % break long url

%%%%% biblatex
\RequirePackage[backend=biber,%
style=gb7714-2015,gbpub=false,gbtype=false,gbpunctin=false,%
url=false,doi=false,isbn=false]{biblatex}

% https://tex.stackexchange.com/questions/247185/tcolorbox-theorem-which-isnt-framed-on-the-sides
\RequirePackage[breakable]{tcolorbox}
\newtcolorbox{mainbodybox}[1]{breakable,sharp corners,nobeforeafter,%
  colback=white,coltitle=black,colbacktitle=white,%
  boxrule=.5pt,titlerule=0pt,%
  bottomrule at break=.5pt,after skip=-1.5pt,% bottomrule=0pt, bottom=1em,
  before upper={\parindent 2em},% indentfirst  
  fonttitle=\large\bfseries,title=#1}

% \singlespacing, \onehalfspacing, \doublespacing
\RequirePackage[doublespacing]{setspace}
\renewcommand\doublespacing{\setstretch{1.6}}

\setlength{\parindent}{2em}

\pagestyle{empty}

\newcommand{\SWFUtitlepage}{% Title page layout
  \thispagestyle{empty}
  \begin{center}
    \makebox[14em][s]{\LARGE\heiti è¥¿å—æ—ä¸šå¤§å­¦}\\[5mm]
    \makebox[28em][s]{\LARGE\heiti æœ¬ç§‘æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰å¼€é¢˜æŠ¥å‘Š}\\[5mm]
    \vskip 3cm
    \begin{large}
      \begin{minipage}{1.0\linewidth}
        \begin{tabularx}{\textwidth}{@{}rX@{}}
          \makebox[5em][s]{è®ºæ–‡é¢˜ç›®}%
          &\makebox[0pt][t]{%
            \begin{minipage}[t]{30em}
              \begin{center}
                \parbox[t]{29em}{\centering\bfseries\Large\@title}
              \end{center}
            \end{minipage}}%
            \rule[-1.5ex]{30em}{.1pt}\par%
            \rule[-1.5ex]{30em}{.1pt}\\%
        \end{tabularx}
      \end{minipage}
      \vskip 2cm
      \begin{minipage}{.8\linewidth}
        \begin{center}
          \begin{tabularx}{\textwidth}{@{}rC@{}}
            \makebox[7em][s]{ä¸“ä¸šåç§°}&\SWFU@Subject\\[-1ex]\cline{2-2}
            \makebox[7em][s]{å¹´çº§}&\SWFU@Grade\\[-1ex]\cline{2-2}
            \makebox[7em][s]{å­¦ç”Ÿå§“å}&\@author\\[-1ex]\cline{2-2}
            \makebox[7em][s]{å­¦ç”Ÿå­¦å·}&\SWFU@Studid\\[-1ex]\cline{2-2}
            \makebox[7em][s]{æŒ‡å¯¼æ•™å¸ˆ (èŒç§°)}&\SWFU@Advisor{}ï¼ˆ\SWFU@AdvisorTitleï¼‰\\[-1ex]\cline{2-2}
                                      &\\[-1ex]\cline{2-2}
            \makebox[7em][s]{å¡«è¡¨æ—¶é—´}&%
          \SWFU@Year{}å¹´\,\SWFU@Month{}æœˆ\,\SWFU@Date{}æ—¥\\[-1ex]\cline{2-2}
          \end{tabularx}
        \end{center}
      \end{minipage}
    \end{large}
    \vfill
    {\Large\bfseries è¥¿å—æ—ä¸šå¤§å­¦æ•™åŠ¡å¤„åˆ¶}\\[1cm]
  \end{center}
  \clearpage}

\newcommand{\instructionpage}{% Instruction page
  \begin{center}
    \LARGE\bfseries\makebox[7em][s]{å¡«è¡¨è¯´æ˜}
  \end{center}
  \vskip 5ex
  \begin{itemize}
  \item[ä¸€ã€] å¼€é¢˜æŠ¥å‘Šå„é¡¹å†…å®¹è¦å®äº‹æ±‚æ˜¯ï¼Œé€æ¡è®¤çœŸå¡«å†™ï¼Œè¡¨è¾¾è¦æ˜ç¡®ã€ä¸¥è°¨ã€‚å¤–æ¥è¯­åº”ç”¨ä¸­æ–‡å’Œ
    è‹±æ–‡åŒæ—¶è¡¨è¾¾ï¼Œç¬¬ä¸€æ¬¡å‡ºç°çš„ç¼©å†™è¯ï¼Œé¡»æ³¨å‡ºå…¨ç§°ã€‚
  \item[äºŒã€] å¼€é¢˜æŠ¥å‘Šéœ€ç”¨è®¡ç®—æœºæ‰“å°ï¼Œä¸€å¾‹ä¸º A4 å¼€æœ¬ï¼Œäºå·¦ä¾§è£…è®¢æˆå†Œã€‚å„æ ç©ºæ ¼ä¸å¤Ÿæ—¶ï¼Œè¯·è‡ª
    è¡ŒåŠ é¡µã€‚
  \item[ä¸‰ã€] å¼€é¢˜æŠ¥å‘Šéœ€åœ¨ç¬¬å…«å­¦æœŸå¼€å­¦ä¹‹å‰å®Œæˆã€‚
  \item[å››ã€] å¼€é¢˜æŠ¥å‘Šéœ€è£…å…¥è¥¿å—æ—ä¸šå¤§å­¦æ¯•ä¸šè®ºæ–‡ï¼ˆè®¾è®¡ï¼‰æ¡£æ¡ˆè¢‹ã€‚
  \end{itemize}
  \clearpage}

\newcommand{\tablebody}{% main part
  \begin{singlespace}
    \noindent
    \begin{tabularx}{\linewidth}{|M{2em}|@{}X@{}|}\hline
      æŒ‡å¯¼æ•™å¸ˆåŸºæœ¬æƒ…å†µ%
      & {\begin{tabularx}{\linewidth}{c|c|c|c|c|C}
           æŒ‡å¯¼æ•™å¸ˆå§“å%
           &\makecell*{æ€§\\åˆ«}&\makecell*{å¹´\\é¾„}&\makecell*{å­¦å†æˆ–\\å­¦ä½}%
           &\makecell*{ä¸“ä¸šæŠ€æœ¯\\èŒåŠ¡æˆ–èŒç§°}&å·¥ä½œå•ä½\\\hline
           \SWFU@Advisor%
           &\SWFU@AdvisorGender&\SWFU@AdvisorAge&\SWFU@AdvisorDegree%
           &\SWFU@AdvisorTitle&\SWFU@AdvisorFrom\\\hline
           &&&&&\\
         \end{tabularx}}\\\hline
      è¯¾é¢˜æ¥æº%
      & \qquad\SWFU@PrjFrmA{}ç§‘ç ”é¡¹ç›®%
        \qquad\SWFU@PrjFrmB{}ç¤¾ä¼šå®è·µ%
        \qquad\SWFU@PrjFrmC{}å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®%
        \qquad\SWFU@PrjFrmD{}å…¶å®ƒæ¥æº\\[2ex]%
    \end{tabularx}
  \end{singlespace}
  \vskip -2pt
  \begin{mainbodybox}{1.\, è¯¥ç ”ç©¶çš„ç›®çš„ã€æ„ä¹‰}
    \SWFU@Partone
  \end{mainbodybox}
  \begin{mainbodybox}{2.\, å›½å†…å¤–ç ”ç©¶ç°çŠ¶åŠå‘å±•è¶‹åŠ¿}
    \SWFU@Parttwo
  \end{mainbodybox}
  \begin{mainbodybox}{3.\, ä¸»è¦å‚è€ƒæ–‡çŒ®}
    \SWFU@Partthree
  \end{mainbodybox}
  \begin{mainbodybox}{4.\, è¯¥ç ”ç©¶çš„ä¸»è¦å†…å®¹ï¼Œé‡ç‚¹è§£å†³çš„é—®é¢˜ï¼Œé¢„æœŸç»“æœæˆ–æˆæœ}
    \SWFU@Partfour
  \end{mainbodybox}
  \begin{mainbodybox}{5.\, æ‹Ÿé‡‡å–çš„ç ”ç©¶æ–¹æ³•æˆ–å®éªŒæ–¹æ³•ï¼Œæ­¥éª¤ï¼Œå¯èƒ½å‡ºç°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³åŠæ³•}
    \SWFU@Partfive
  \end{mainbodybox}
  \begin{mainbodybox}{6.\, å®Œæˆè¯¥ç ”ç©¶å·²å…·å¤‡çš„æ¡ä»¶}
    \SWFU@Partsix
  \end{mainbodybox}
  \begin{mainbodybox}{æŒ‡å¯¼æ•™å¸ˆæ„è§}
    \bigskip
    \SWFU@AdvisorComment\par
    \hfill ç­¾åï¼š\makebox[7em]{\SWFU@AdvisorSig}\par
    \medskip
    \hfill\SWFU@Year å¹´ \SWFU@Month æœˆ \SWFU@Date æ—¥
  \end{mainbodybox}
  \noindent
  \begin{tcolorbox}[sharp corners,nobeforeafter,%
    left=0pt,right=0pt,top=-13pt,bottom=0pt,boxsep=0pt,%
    colback=white, boxrule=.5pt]
    \singlespacing\noindent
    \begin{tabularx}{\linewidth}{P{1em}|X|P{1em}|X}
      \qquad{}æ•™ç ”å®¤æ„è§%
      & æ•™ç ”å®¤è´Ÿè´£äººï¼š\par%
        \vspace*{18ex}%
        \hfill{}å¹´\qquad{}æœˆ\qquad{}æ—¥%
      & \quad{}æ•™å­¦é™¢ç³»éƒ¨æ„è§\par%
      & æ•™å­¦é™¢ç³»éƒ¨è´Ÿè´£äººï¼š\par%
        \vspace*{18ex}%
        \hfill{}å¹´\qquad{}æœˆ\qquad{}æ—¥\\
    \end{tabularx}    
  \end{tcolorbox}%
}

\newcommand{\makeproposal}{%
  \SWFUtitlepage{}
  \instructionpage{}
  \tablebody{}
}
